# IV. 地質図ツールの機能

地質図ツールのメニューまたはツールバーから以下の各機能を使用することができます。  

## レイヤツール  

### 地質図レイヤの追加  

地質図レイヤファイル(GeoPackage)を作成しレイヤーツリーに追加します。

![地質図レイヤの作成ダイアログ](./img/chapter04_03_2.png)  

> ※ 標準メニューの[レイヤ]-[レイヤを作成]でレイヤを作成すると、地質図用の属性をもつレイヤが作成されませんので、本プラグインで編集する地質図レイヤを作成する場合は、必ず本メニューからレイヤを作成してください。  

① メニューまたはツールバーで **[レイヤツール]-[地質図レイヤを追加]** をクリックします。  
② レイヤ作成ダイアログが表示されたら、以下の項目を指定して **[作成]**  ボタンをクリックします。  

* **作成の種類** ：「新規地質図の作成」か「既存地質図のインポート」のどちらかを選択します。
　「既存地質図のインポート」の場合は、インポートするファイルを指定します。
* **フォルダ名**：地質図レイヤファイルを保存先のフォルダを選択します。  
* **ファイル名**：この名称（＋.gpkg）で地質図レイヤファイルが作成されます。  
* **レイヤグループ名**：このグループ名でレイヤーが作成されます。  


> マップ種類で「既存ファイルのインポート」を選択すると、ファイル選択を行う欄が表示されます。ここに別のプロジェクトで作成したレイヤーのファイルを指定すると、既存のレイヤーをこのプロジェクトに取り込むことができます。  
> ただし、スタイルなどは正しく取り込めません（新規の場合に使用しているテンプレートスタイルが適用されます）ので、取り込んだ後に修正してください。

レイヤグループとレイヤが作成され、レイヤパネルに表示されます。

> ※ プロジェクトファイルが保存されていないと本プラグインは動作しません。
> ※ 背景地図は、国土地理院の地理院タイル等をご使用ください。（[レイヤ]-[レイヤを追加]-[XYZレイヤを追加...]から追加できます）  
> ※ 本プラグインの地質図には、参照座標系（CRS）はWGS84（EPSG:4326）またはJGD2000（EPSG4612）を使用します。 利用する地図の座標系に応じて設定を変更したい場合は、プロジェクトプロパティを開いて変更してください。

### GeoClinoデータのインポート  

GeoClino for iPhoneの測定データ（XMLファイル）を地質図マップのstrdipレイヤの地物としてインポートします。  

![Geoclinoデータのインポート](./img/chapter04_05.png)  

① メニューまたはツールバーの  **[レイヤツール]-[Geoclinoデータのインポート]** をクリックします。  
② GeoClinoデータのインポートダイアログが表示されたら、 **[選択]** をクリックして、GeoClinoデータが格納されているXMLファイルを選択します。  
③   インポート先レイヤを選択して **[インポート実行]** をクリックします。  

指定したstrdip(走向・傾斜)レイヤにGeoClonoデータがインポートされます。

## 編集ツール [Editing Tool]  

編集ツールで、マップキャンバスの地物の追加・編集を行ないます。  
レイヤパネルで編集を行いたいレイヤを選択したうえで、ツールバーの各ボタンをクリックして地物の編集を行います。  

![編集ツール ツールバー](./img/chapter04_06.png)  

### ①レイヤの更新  
* 選択しているレイヤの地物のスタイル表示を最新化します。  

### ②地物の編集  

下記の属性編集パネルを表示します。選択した地物の属性を編集することができます。
属性編集パネルを表示させた状態で、レイヤーツリーから地質図レイヤを選択します。
マップキャンバス上で地物を選択すると、選択した地物の属性項目を編集することができます。

![属性編集パネル](./img/chapter04_07.png) 

[保存]をクリックすると、属性が更新されます。
また、スタイルの[編集]をクリックすると、そのレイヤのレイヤプロパティが表示され、選択しているレイヤのシンボルやレイヤの表示設定を変更することができます。

> ※ レイヤの種類に応じて、表示される属性項目が変わります。うまく表示されない場合は、レイヤツリーで他のレイヤを一度選択してから、もう一度編集したいレイヤを選択してください。
> ※ 本プラグインで作成した「地質図レイヤ」以外のベクタレイヤでは、この属性編集パネルでは属性の更新は行えません。また、本パネルを表示させた状態で「地質図レイヤ」以外のレイヤを選択するとエラーメッセージ（ワーニング）が表示されることがあります。エラーメッセージを完全に消去するにはQGISを再起動してください。
> 走向・傾斜レイヤでシンボルの表示で「？」と表示されてしまう場合は、シンボルのSVGマーカーが正しく参照できていません。このような場合は、スタイルの[編集]をクリックしてレイヤプロパティを開き、SVGマーカーのファイルの参照を再設定してください。

### ③地物の追加 [Add Feature]  
* このボタンがONのとき、地図キャンバスをクリックすると新たな図形が追加されます。（ラインやポリゴンの場合は、左クリックを連続して線を描画して、右クリックで終了します）  

### ④地物の移動 [Move Feature]  
* このボタンがONのときは、図形を選択して一括で移動が行えます。  

### ⑤ノード編集 [Vetrex Tool]  
* このボタンがONときは、図形の頂点を選択して移動させることにより、図形の変形が行えます。  

### ⑥地物の分割 [Split Features]  
* このボタンがONのとき、地図キャンバスで線を引くと、その線の両側で図形が分割されます。  

### ⑦地物の結合 [Merge Features]  
* 2つ以上の図形を選択した状態でこのボタンをクリックすると、その図形が結合されます。同じ性質を持つ図形の属性を一致させるときに使用します。  

### ⑧地物の削除 [Delete Features]  
* 選択している地物を削除します。複数の地物を選択して一括で削除することができます。  

### ⑨地物のコピー [Copy Features]  
* 選択した地物をクリップボードにコピーします。  

### ⑩地物の貼り付け [Paste Features]  
* クリップボードにある地物を別のレイヤ（同じ種類のレイヤのみ）に貼り付けます。

> 「編集ツール」の③~⑩は、QGIS標準の「デジタイジングツールバー」でよく使用する機能の中から、より簡単に操作ができる（地物編集時クリックの回数を減らせる）ように動作をまとめた機能になります。  
> この編集ツールに無い高度な編集を行うには、QGIS標準の編集機能を使用することももちろんできます。ただし、レイヤーグループ名やレイヤー名の変更、地物属性の追加・変更等を行うと、プラグインの諸機能を使用する際にエラーが生じることがありますのでご注意ください。

 
## 走向線の描画  

観測地点の走向・傾斜データまたは３点の標高をもとに地質境界線を描画する際に、補助走向線を表示することができます。走向・傾斜データを一つ選択した状態で[走向線の描画]をクリックすると、走向線が表示されます。もういちどこのボタンをクリックすると、走向線は消えます。（走向線の本数や間隔、色などは、[設定(Settings)]の「地質図設定で」変更することができます）

![走向線の描画](./img/chapter04_08.png)  

 メニューまたはツールバーの  **[走向線の描画]** をクリックすると、「走向線描画ツールパネル」が表示されます。（もう一度クリックすると消えます）  

**【走向・傾斜データをもとに走向線を描画する】**  
① 「走向線描画ツール」パネルで「走向/傾斜を選択して描画」タブにして、計算する地物データがある走向傾斜レイヤーを選択します。  
③ マップキャンバスで、計算元となる地点の走向・傾斜の地物データを選択します。  
③ 「走向線描画ツール」パネルで、**[クリックして選択地物の走向傾斜値を選択]**  ボタンをクリックすると、選択した走向・傾斜の値が表示されます。  
④ **[走向線を描画]** ボタンをクリックすると、マップキャンバス上に走向線が表示されます。  
⑤ **[走向線を消去]**  ボタンをクリックすると、描画されている走向線が消えます。

**【3点の標高をもとに走向線を描画する】**  
① 「走向線描画ツール」パネルで「３点法による描画」タブにして、使用する標高DEMを選択します。  
② 「走向線描画ツール」パネルで、**[ここをクリックしてキャンパス上で３点を選択]**  ボタンをクリックすると、マップキャンバス上でのマウスカーソルが十字に変わります。  
③ マップキャンバスで、３つの点（同一の地層境界がある点）をクリックして選択すると、指定した点の経度・緯度・標高が表示されます。  
④ **[計算を実行]** ボタンをクリックすると、指定した３点をもとにした走向線の走向・傾斜の値が表示されます。
⑤ **[走向線を描画]** ボタンをクリックすると、マップキャンバス上に走向線が表示されます。  
⑥ **[走向線を消去]**  ボタンをクリックすると、描画されている走向線が消えます。  

> 走向線の表示間隔、長さ、色などは、 **[設定s]** で変更することができます。  


### ヘルプ [Geolib3 Help]   

このファイルを表示します。  
