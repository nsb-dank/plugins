# V.	地物の作成・編集の手順

編集ツールバーを使用した地物の作成・編集方法

### 【地物を追加する】  

①	レイヤパネルで地物を選択するレイヤを選択します。

⇩ 編集ツールバーの[地物の追加]ボタンが使用可能になります。
②	「編集ツールバー」の[地物の追加]ボタンをクリックして、地物追加モードをONの状態にします。
⇩ 地図キャンバスでの操作が地物追加モードになります。
③	地図キャンバス上で追加したい地点をクリックすると、地物が追加されます。
 　 　
ラインやポリゴンを描画する場合は、左クリックしてラインやポリゴンの中間ノードを追加していき、終端で右クリックします。
④	[地物の追加]ボタンをもう一度クリックしてOFFにすると、地物の選択モードに戻ります。

### 【地物の属性を編集する】  

①	地物の選択モードの状態で、編集したい地点の地物をクリックまたは範囲指定して選択します。
⇩ 編集ツールバーの[属性編集]ボタンが使用可能になります。
②	 [属性編集]ボタンをクリックします。
⇩ 地物編集ダイアログが表示されます。
③	「属性編集」ダイアログで各属性を入力して [OK]ボタンをクリックします。
※レイヤによって、属性の内容が異なります。
 　 　

④	地図キャンバスの地物が、指定したシンボルになっていることを確認します。
 　 　

### 【凡例（スタイル）を追加・変更するには】  

現在選択しているレイヤで使用している凡例（スタイル）は、レイヤのプロパティまたはレイヤスタイルパネルで表示されます。
新しい凡例を追加したり、スタイルを変更する場合は、このレイヤプロパティまたはレイヤスタイルパネルを使用して以下のように行います。
＜スタイルを変更する＞
①	レイヤパネルで右上の（レイヤスタイルドックを開く）をクリックして、レイヤスタイルを表示します。
②	レイヤパネルでスタイルを変更したいレイヤを選択します。

⇩ レイヤスタイルが表示されます。
③	変更するシンボルをダブルクリックします。

⇩ シンボルセレクタに画面が切り替わります。
④	シンボルレイヤ（下の図の例では「SVGマーカー」）をクリックします。
⑤	シンボルレイヤタイプを選択し、大きさや色など必要なプロパティを設定します。
Web地学ライブラリで使用できるシンボルレイヤタイプは以下のいずれかです。
ポイント：SVGマーカー または シンプルマーカー（円のみ）
ライン：シンプルライン
ポリゴン：シンプル塗りつぶし
⑥	シンボルレイヤタイプが「SVGマーカー」の場合は、SVGイメージを選択します。
地学ライブラリツールプラグインのデフォルトで使用しているSVGイメージを使用するには、SVGグループで「geolib」を選択します。
⑦	[Apply（適用）]をクリックすると、シンボルの変更が適用されます。


※走向・傾斜のようにシンボルの「回転」を行う場合は、レイヤスタイルパネルの[回転]のプロパティで回転角が格納されているフィールド（以下の例の場合は「strike_value」）を指定します。


＜スタイルを追加する＞
①	レイヤスタイルパネルで下のほうにある [+]ボタンをクリックします。

⇩ シンボルリストの一番下に新たなシンボルが追加されます。
②	追加されたシンボルの値（検索キーになります）と凡例を入力します。


③	追加されたシンボルをダブルクリックして形状や色を変更します。

### 【走向線を表示する】  

地層の境界を描画する際に、以下の手順で走向・傾斜データの測定点からの走向線を表示することができます。
①	レイヤパネルで「strdip(走向・傾斜)」レイヤを選択します。
②	走向線を引くもととなる走向・傾斜データ（地物）を選択します。
 ⇩ 編集ツールバーの「走向線を描画」ボタンが使用可能になります。
③	「編集ツールバー」の [走向線を描画]ボタン をクリックすると、地図キャンバスに走向線が表示されます。
 　　
（既定では、赤線は走向・傾斜測定地点と同高度、橙色は高高度、水色は低高度で10mごとに（補助線は5mごと）に描画しています。走向線の表示高度の間隔や色などの設定は、メニュー[地学ライブラリツール]-[設定]の「地質図設定」タブを開いて変更することができます。
描画された走向線は、以下の④の操作を行わない限り表示は消えませんので、走向線を描画した状態で「地質境界線」を引くことができます。
④	走向線を消去するには、「走向・傾斜」レイヤを選択したのち、[走向線を描画]ボタン をクリックしてOFFにします。

### 【描画した地物の修正・削除を行う】  

地物の追加・編集を繰り返して地図を作成していきますが、誤って描画した地物を削除したり、一度描画した地物を修正したりする必要があります。
そのような場合は、「編集ツールバー」の以下の機能を使用します。
＜地物の一部（ノード）を移動する＞
ポリゴンの形を変えたり、ラインの位置を修正する場合は、以下のように「ノードの修正」で行います。
①	「編集ツールバー」の [ノード編集]ボタン をクリックします。
地図キャンバスで修正したい地物を選択します。
⇩その地物に属する頂点（ノード）が赤い□(または●)で表示されます。

　　
②	変形したい頂点（ノード）をクリックします。
⇩選択した頂点が別の色・形（大きい●など）に変わります。

③	選択した頂点をマウスでドラッグ＆ドロップします

⇩ ドロップした場所に頂点が移動します。

④	修正が完了したら、[ノードの修正]ボタンをもう一度クリックすると修正が保存されます。

※頂点の中間点にマウスを移動すると×が表示されます。ここをクリックすると頂点を追加することができます。

ポリゴン（地層面等）の境界をライン（地層境界線等）と一致させるには
地層面などのポリゴンを描画する際、その境界を地層境界線などのラインと一致させるには以下のように「スナップ」機能を有効したうえで、以下の要領で描画します。
①	ポリゴンの線分上でマウスをダブルクリックして頂点（ノード）を作成します。

②	頂点（ノード）上で左ボタンを押下したまま、境界線に沿ってマウスを移動します。


③	境界線の頂点が近づくと、移動中の頂点が自動的に吸着します。


④	マウスの左ボタンを離すと、境界線の頂点上に地質面の頂点がスナップされます。


### 【地物を削除する】  

地物を削除する場合は、以下のように行います。
①	削除する地物を選択します。

②	「編集ツールバー」の [地物の削除]ボタンをクリックします。
⇩ 地物が削除されます。



### 【地物を分割する】  

境界線や地層面を複数の地物に分割する場合は、以下のように行います。
①	「編集パネル」の[地物の分割]ボタンをクリックします。

⇩ 地図キャンバス上でマウスカーソルが変わります。
②	地図キャンバスで、分割する地物を切るようにマウスでラインを引きます。

⇩ ラインの両側で地物が分割されます。


【地物を結合する】
同じ属性も持つ地物同士をを結合する（一つの地物にする）場合は、以下のように行います。
①	結合する地物（２つ以上）を選択します。


②	「編集ツールバー」の [地物の結合]ボタン をクリックします。

⇩ 「地物の結合」ダイアログが表示されます。
③	通常はこのまま [OK]ボタン をクリックします。

④	２つの地物が１つに結合されます。

 [地学ライブラリにエクスポート]
地学ライブラリツールプラグインを使用して作成したシナリオレイヤおよび地質図レイヤのデータを「Web地学ライブラリ」のデータベースにエクスポートすることができます。
Web地学ライブラリにアップロードを行うには、Web地学ライブラリの利用者ID（メールアドレス）およびパスワードが必要です。
Web地学ライブラリサーバーに接続する
まず、以下の手順でWeb地学ライブラリサーバーに接続します。
※接続がうまくいかない場合は、地学ライブラリメニューの[設定]で設定ダイアログを開き、「地学ライブラリ設定」タブでサーバー情報を確認してください。
①	[Webライブラリにエクスポート]ボタンをクリックします。
⇩ 「Webライブラリにエクスポート」ダイアログが表示されます。

②	[接続]ボタンをクリックします。
⇩ 既に登録済のライブラリ一覧が表示されます。


ライブラリを登録・編集する
ライブラリの登録・編集は以下の手順で行います。

①	ライブラリを新規登録する場合は[新規ライブラリ]ボタンをクリックします。
既存のライブラリを編集するときは、編集したいライブラリ行をダブルクリックします。

⇩ライブラリ情報入力項目が表示されます。

②	ライブラリ情報を入力して、[保存]ボタンをクリックします。

⇩ 保存が完了すると、メッセージが表示されます。


マップデータを登録・編集する
ライブラリに表示するマップデータの登録およびアップロードは以下の手順で行います。
①	マップデータの登録・編集を行うライブラリをダブルクリックします。

⇩現在登録されているマップデータが表示されます。

### 【シンボルアイコンおよびシナリオファイルをアップロードする】  

まず、各種マップで使用しているSVGアイコンおよびシナリオファイル（HTMLおよびリンクしている画像ファイルなど）をサーバーにアップロードします。
②	アップロードを行うファイルの種類にチェックをして、[チェックしたファイルをアップロード]ボタンをクリックします。

⇩アップロードが完了すると、メッセージが表示されます。

※同名のファイルが既にサーバーに存在する場合は、上書きされます。

### 【マップデータをアップロードする】  

続いて、QGISで作成した各種マップデータをサーバーにアップロードします。
③	マップを新規登録する場合は[新規マップ登録]ボタンをクリックします。既存のマップを編集するときは、編集したいマップ行をダブルクリックします。

⇩「マップにエクスポート」ダイアログが表示されます。

④	マップ情報を入力して、[保存]ボタンをクリックします。


マップの種類により、QGISで作成したプロジェクトのレイヤ構造に合わせて保存できるレイヤが変わります。
保存先フォルダの右の欄にレイヤーを指定すると、サーバーのレイヤーファイルがQGISで作成したレイヤーの情報で上書きされます。
⇩保存が完了すると、メッセージが表示されます。


※マップの種類が「Associated」の場合は、下図のようにここで表示したいオープンデータのURLを指定します。
現在、Associatedのマップに使用できるのはXYZタイル形式で提供されているオープンデータのみです。


